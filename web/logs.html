<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logs de Sauvegarde</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìã Logs de Sauvegarde</h1>
            <nav>
                <a href="index.html">Accueil</a>
                <a href="manage.html">G√©rer</a>
                <a href="logs.html" class="active">Logs</a>
            </nav>
        </header>

        <div class="grid">
            <div class="card">
                <h2>Fichiers de Log</h2>
                <div class="log-list" id="log-list">
                    <div class="log-item">
                        <div class="log-link" onclick="loadLog('sauvegarde_20250127.log')">
                            <span class="log-name">sauvegarde_20250127.log</span>
                            <span class="log-info">2025-01-27 14:30:25 - 15.2 KB</span>
                        </div>
                    </div>
                    <div class="log-item">
                        <div class="log-link" onclick="loadLog('sauvegarde_20250126.log')">
                            <span class="log-name">sauvegarde_20250126.log</span>
                            <span class="log-info">2025-01-26 14:30:18 - 12.8 KB</span>
                        </div>
                    </div>
                    <div class="log-item">
                        <div class="log-link" onclick="loadLog('sauvegarde_20250125.log')">
                            <span class="log-name">sauvegarde_20250125.log</span>
                            <span class="log-info">2025-01-25 14:30:12 - 18.5 KB</span>
                        </div>
                    </div>
                </div>
                <button onclick="refreshLogs()" class="btn btn-secondary">Actualiser</button>
            </div>

            <div class="card log-viewer" id="log-viewer" style="display: none;">
                <h2>Contenu : <span id="current-log-name"></span></h2>
                <div class="log-content">
                    <pre id="log-content"></pre>
                </div>
                <div class="log-actions">
                    <button onclick="downloadLog()" class="btn btn-primary">T√©l√©charger</button>
                    <button onclick="clearLogViewer()" class="btn btn-secondary">Fermer</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Commandes Utiles</h2>
            <div class="command-list">
                <div class="command-item">
                    <strong>Suivre les logs en temps r√©el :</strong>
                    <code>tail -f /var/log/sauvegardes/sauvegarde_$(date +%Y%m%d).log</code>
                </div>
                <div class="command-item">
                    <strong>Voir les erreurs r√©centes :</strong>
                    <code>grep "ERREUR" /var/log/sauvegardes/sauvegarde_*.log | tail -10</code>
                </div>
                <div class="command-item">
                    <strong>Logs de fallback :</strong>
                    <code>cat /tmp/backup_fallback_errors.log</code>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Statistiques</h2>
            <div class="stats" id="stats">
                <div class="stat-item">
                    <span class="stat-label">Sauvegardes r√©ussies (7j) :</span>
                    <span class="stat-value" id="success-count">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Sauvegardes √©chou√©es (7j) :</span>
                    <span class="stat-value" id="error-count">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Taille totale des logs :</span>
                    <span class="stat-value" id="total-size">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLogContent = '';
        let currentLogName = '';

        function loadLog(filename) {
            // Simulation du contenu d'un log
            const sampleLog = `2025-01-27 14:30:25 [INFO] === D√âBUT DES SAUVEGARDES ===
2025-01-27 14:30:25 [INFO] S√©lections √† traiter : docs_eric docs_fanou
2025-01-27 14:30:25 [INFO] Traitement de la sauvegarde 'Docs Eric'...
2025-01-27 14:30:25 [INFO] D√©marrage de la sauvegarde locale pour '/home/eric/Documents' vers '/mnt/backup_nas/DocumentsEric/'.
2025-01-27 14:30:25 [INFO] Commande Rsync √† ex√©cuter : rsync -avh --partial --progress --info=progress2,misc0,name0 /home/eric/Documents/ /mnt/backup_nas/incremental-DocumentsEric/daily-2025-01-27_143025
2025-01-27 14:30:26 [INFO] Ex√©cution de rsync (sans timeout).
2025-01-27 14:30:28 [INFO] Sauvegarde r√©ussie de '/home/eric/Documents' vers '/mnt/backup_nas/incremental-DocumentsEric/daily-2025-01-27_143025'.
2025-01-27 14:30:28 [INFO] Lien 'current' mis √† jour vers '/mnt/backup_nas/incremental-DocumentsEric/daily-2025-01-27_143025'.
2025-01-27 14:30:28 [INFO] Traitement de la sauvegarde 'Docs Fanou'...
2025-01-27 14:30:28 [INFO] D√©marrage de la sauvegarde locale pour '/home/fanou/Documents' vers '/mnt/backup_nas/DocumentsFanou/'.
2025-01-27 14:30:28 [INFO] Commande Rsync √† ex√©cuter : rsync -avh --partial --progress --info=progress2,misc0,name0 /home/fanou/Documents/ /mnt/backup_nas/incremental-DocumentsFanou/daily-2025-01-27_143028
2025-01-27 14:30:29 [INFO] Ex√©cution de rsync (sans timeout).
2025-01-27 14:30:31 [INFO] Sauvegarde r√©ussie de '/home/fanou/Documents' vers '/mnt/backup_nas/incremental-DocumentsFanou/daily-2025-01-27_143028'.
2025-01-27 14:30:31 [INFO] Lien 'current' mis √† jour vers '/mnt/backup_nas/incremental-DocumentsFanou/daily-2025-01-27_143028'.
2025-01-27 14:30:31 [INFO] === FIN DES SAUVEGARDES ===
2025-01-27 14:30:31 [INFO] R√©sum√© :
2025-01-27 14:30:31 [INFO]   - Sauvegardes r√©ussies: 2
2025-01-27 14:30:31 [INFO]   - Sauvegardes √©chou√©es: 0
2025-01-27 14:30:31 [INFO]   - Total des sauvegardes trait√©es: 2
2025-01-27 14:30:31 [INFO] Toutes les sauvegardes ont √©t√© effectu√©es avec succ√®s.
2025-01-27 14:30:31 [INFO] Script de sauvegarde termin√©.`;

            currentLogContent = sampleLog;
            currentLogName = filename;
            
            document.getElementById('current-log-name').textContent = filename;
            document.getElementById('log-content').textContent = sampleLog;
            document.getElementById('log-viewer').style.display = 'block';
            
            // Marquer comme actif
            document.querySelectorAll('.log-link').forEach(link => link.classList.remove('active'));
            event.target.closest('.log-link').classList.add('active');
        }

        function clearLogViewer() {
            document.getElementById('log-viewer').style.display = 'none';
            document.querySelectorAll('.log-link').forEach(link => link.classList.remove('active'));
        }

        function downloadLog() {
            if (!currentLogContent) return;
            
            const blob = new Blob([currentLogContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentLogName;
            a.click();
            URL.revokeObjectURL(url);
        }

        function refreshLogs() {
            // Simulation - dans un vrai environnement, ceci ferait un appel au serveur
            const logList = document.getElementById('log-list');
            const today = new Date();
            const todayStr = today.toISOString().slice(0, 10).replace(/-/g, '');
            
            logList.innerHTML = `
                <div class="log-item">
                    <div class="log-link" onclick="loadLog('sauvegarde_${todayStr}.log')">
                        <span class="log-name">sauvegarde_${todayStr}.log</span>
                        <span class="log-info">${today.toLocaleString('fr-FR')} - 15.2 KB</span>
                    </div>
                </div>
            ` + logList.innerHTML;
            
            updateStats();
        }

        function updateStats() {
            // Simulation des statistiques
            document.getElementById('success-count').textContent = '14';
            document.getElementById('error-count').textContent = '1';
            document.getElementById('total-size').textContent = '156.8 KB';
        }

        // Initialisation
        updateStats();
    </script>
</body>
</html>